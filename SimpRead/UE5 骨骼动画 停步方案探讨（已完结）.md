---
url: https://zhuanlan.zhihu.com/p/653171929
title: UE5 骨骼动画 停步方案探讨（已完结）
author: zhuanlan.zhihu.com
aliases: 
 - 
date: 2026-02-12 16:18:37
tags:

banner: "https://pic1.zhimg.com/v2-ba9551de0ea7b480c556e75919c8bec7_720w.jpg?source=172ae18b"
banner_icon: 🔖
---
否定自己所走过的路途，就意味着否定现在的自己，我不想这么做。若是没有积累至今的过去，我现在便无法站在这里！

静息（Idle），起步（Start），走跑循环（Cycle），停步（Stop）。这四个状态构成了一个非常标准的地面上的运动循环框架。今天我想和大伙聊聊制作一个停步状态可以有哪些方案。

在开始之前需要明确一点：方案的选择没有高下之分，只有适合与否。

方案的选择一定是要根据项目的——

游戏类型：（就像 fps 游戏往往对动画的重视程度就不如 arpg）

玩家受众：（玩家看重哪些方面，审美能力到哪里）

动画资源的特点：姿态是否中立，是长过渡还是短过渡等等（我经验尚浅，恳请大佬们补充）

性能开销和维护难度：通常越复杂的停步逻辑开销也就越大，维护也越困难。[MotionMatching](https://zhida.zhihu.com/search?content_id=233277964&content_type=Article&match_order=1&q=MotionMatching&zhida_source=entity) 是个例外。

——来综合决定的。而不是说哪个方案更能炫技就选择哪个。

## **0. 原始的停步方案**

这种方案常见于一些不重视 [Locomotion](https://zhida.zhihu.com/search?content_id=233277964&content_type=Article&match_order=1&q=Locomotion&zhida_source=entity) 动画，或者动画技术力较差的游戏中。比如 P5R，恋活等。（当然，p5 的玩家受众也决定了粗糙的动画是能够被接受的，哎虽然我也想不明白 ATLUS 都知道怎么做 NPC 视线追随了为什么走路滑步，起步停步这种顺手的事不去做一下）

![](https://pic3.zhimg.com/v2-ee15d37d6586c29f4f81008ffde9a2e0_r.jpg)

这种方案中常见的做法一般是直接将 Cycle 与一个 Stop 动画做混合。更有甚者压根没有 “Stop” 这个状态（没 stop 的一般也没有 start），在角色停下脚步时是直接将 Cycle 混合到 Idle 去了。

停步动画只有一个的话会有一些比较明显的缺点。比如我们只有一个左脚在前的停步动画，而角色是可能在任意一个时刻结束行走进入停步的。这时如果正好左脚在前，和进入停步动画的姿势很接近，那 OK 没啥问题，基本上能做到无缝混入。但倘若这时角色正好右脚在前，就几乎一定会出现 “拉脚的现象”。

![](https://picx.zhimg.com/v2-a71c1d68f59712eac96406a6efdc596f_b.jpg)

如上面的 GIF，因为停步动画只有左脚在前的，所以当角色在右脚在前进入停步时，就会发生右脚被快速拉回到后方，左脚被快速拉到前方来配合停步的现象。而左脚在前进入停步时，两只脚却基本不用怎么动。

## **1. 区分左右脚谁在前的停步方案（以及各种可能的改进策略）**

这种方案其实就是在上一节的基础上增添了对 “左右脚谁在前面” 的判断，从而选择左脚在前 or 右脚在前的停步动画。

听起来似乎很简单，但实际落地时还有一些问题要克服。

首先，通常情况下这个方案的前提是我们使用的动画库中的停步动画有区分左右脚。如果没有的话我们就只能用 UE5 的镜像节点自己整一份了，整的时候还要比较注意，比如我们的角色是一个单手肩扛大剑的，这种时候可能就只用镜像下半身，而不要镜像上半身的数据。（这张图用黑魂的举例其实也不是很恰当，因为黑魂的上半身持武器是叠加的，一般会放在 Locomotion 的后面）

![](https://pic2.zhimg.com/v2-1ca8802982277a4d637a6a09aaa6e695_r.jpg)

其次，如果角色的站姿是像 ALS 那样是处于 “中立位” 的还好，因为这样无论停步动画是哪只脚在前，停步时走完相同的步数最后脚都是放回中立位。

但如果角色的站姿是像我们第０节录的 gif 里那样，是很有风格的左脚在前，右脚在后的站姿，那美术在制作停步动画时就得面临一点困扰。

为了让问题讨论更加清晰具体，我们先假设：Idle 状态下角色保持着左脚在前，右脚在后的站姿。停步动画分为左脚在前和右脚在前。左脚在前的停步动画会让角色一边减速一边走完两步，并完成到 Idle 的起始帧的过渡。

那么，当美术在制作右脚在前的停步动画时，他很可能面临这样的考量：右脚在前的停步动画如果和左脚在前的停步动画走相同的步数（也就是 2 步），走完后肯定会进入到一个右脚在前，左脚在后的 Idle 站姿里。这时我们有几个可能解决的办法：

**1.** 让右脚在前的停步动画再多迈一步左脚（或者少迈一步）。但这样做的缺点是明明左右脚开始停步时的速度都是相同的，使用的停步步数与停步动画的时长却是不同的，根运动速度也不同。想要让表现效果好，只是简单地让美术将左脚在前的停步动画做一份镜像后再做删减一步，是肯定不可能的。

**2.** 既然会进入到右脚在前的 Idle 站姿中，那就再做一个右脚在前的 idle 姿势不就好了？但这样做的缺点是，既然做了右脚在前的 Idle 姿势，那肯定也得做右脚在前的 Start 姿势。

在角色只有向前移动的动画时可能感觉还行，但如果角色需要八向移动（Strafe）的动画，这就意味着 4（前后左右 4 个方向）x3（Start cycle stop）x2（区分左脚在前和右脚在前），一下子又多了 12 份动画出来。这无疑是对动画资源管理和状态机维护的额外负担。

使用 UE5 的镜像节点可以缓解这个问题，但镜像节点这个东西，用过的读者肯定能感受到它的一些潜在的麻烦，像比如和跨步扭曲（Stride Warping）一起用的时候如果用的是图表（Graph）模式自动计算会有 bug，跨步扭曲的方向不会被及时跟着镜像，可能导致剪刀脚的出现。就目前来说还并不是一个能让人很放心去用的功能。

![](https://pic3.zhimg.com/v2-12a871176ebec74cd42638b5b3875e60_1440w.jpg)

之前面试天智游工作室时，技术负责人和我聊他们去考察了原神的停步方案，他们得出的结论是原神不仅将停步区分左右脚哪个在前，甚至在此基础上还又各区分了两段（比如左脚在前，设迈步的最大距离为 N，就再分成距离中立位 0.25N 与 0.75N 的。），一共有四段停步动画。如果这是真的话，在不使用镜像功能的情况下，原神至少要再多 24 份动画出来……

对于停步的相位划分的越细，效果肯定是越自然，但逻辑的复杂度，易维护性和内存占用就要成为牺牲品。关于这一点可以在一定程度上参考下一节 ALS 的停步，它同样划分了 4 段相位，但因为是程序化停步的原因，所以动画资源的复杂度并不高。

**3.** 让角色先不急着停步，多迈一步至左脚在前的时候再停步。欸，这种方案连右脚在前的停步动画都不用制作了，岂不妙哉？但这种方案同样也是对手感和操控性的破坏，玩家希望角色停下来时，有时好像立刻停下来了，有时却非要再迈一步。不过一般在角色高速奔跑时，多迈这一步的用时非常短，对操控性的影响比较小，可以考虑这么干（但话也说回来了，本身奔跑停步就因为速度较高而不怎么容易穿帮……）

## **2.ALS 的停步**

ALS，动画系统的教科书，我们的老朋友。**它的停步方案中并没有使用专门的停步动画**，它的主要思路就是直接将走跑（Cycle）动画直接与 Idle 动画进行混合，只不过在这个过程中先掺入了 [FootLock](https://zhida.zhihu.com/search?content_id=233277964&content_type=Article&match_order=1&q=FootLock&zhida_source=entity)（脚部锁定）来一次性解决停步时的滑步问题，再掺入了一个整顿脚步的 [Additive 动画](https://zhida.zhihu.com/search?content_id=233277964&content_type=Article&match_order=1&q=Additive%E5%8A%A8%E7%94%BB&zhida_source=entity)去模拟停步表现。

于笔者个人来说，ALS 的停步方案相较于其他方案，值得注意的亮点在于 “对 Cycle 周期的 4 段相位划分”（效果肯定是比只分左右脚哪个在前的 2 段相位划分来得更细腻自然）、“程序化停步”、“FootLock”。

![](https://pic3.zhimg.com/v2-ddf1b7cba236da4cd8c3c3b92d8b2b56_b.webp)

**先说结论和优缺点**：虽然 ALS 作为动画系统的教科书，他的做法非常值得我们参考借鉴，但并不代表他的所有做法都是最好最合适的。其中一个例子就是我们现在所说的停步。通过上面的 GIF 可以看到，只要操控者有心，ALS 在停步时也可以停出 “脚往回拉” 的停步效果出来，而且停步时会感觉“脚太黏”，停得太“突然”。

ALS 呈现出现在这个样子的设计的主要原因并不是因为 “这样设计最好”，而是因为当时 ALS 的作者本身没有能力去在有限的时间内产出较多的高质量运动动画，所以被迫无奈在起步和停步上都使用了偏程序化的手段去做 “次优解”。我们知道 Lyra 的动画系统也是出自 ALS 作者之手，可以看到，一旦有了许多专业的美术人员支持，解决了动画资源匮乏的问题，ALS 作者也立刻转投专用的起步 & 停步动画的怀抱了。

还是那句话，动画方案很多时候没有高下之分，只有适合与不适合。今年公测的二次元 tps 游戏《卡拉彼丘》用的就也是 ALS 的这套方案。对于大多数玩家来说 ALS 的停步效果也足够让他们满意了，并不一定能有这个鉴赏能力去感受出 ALS 这 “次优解” 的一丝丝违和。

因此 ALS 的方案我们还是会简单聊一聊（当然，很多读者已经对 ALS 非常熟了，也可以直接跳过方案实现的部分）

它实现停步动画的思路是：在从 Cycle 往 Stop 动画进行过渡。过渡的终点是一个站立态的静止姿势。而在过渡的过程中，则是一边将动画从 Cycle 动画（走跑运动循环）往静止的姿势过渡；一边添加一个 Additive 的整顿脚步的动画；一边按一定的顺序挨个锁定左脚和右脚。这 “**三个一边**” 构成了 ALS 复杂的程序化停步方案的全部。

### **1.1Cycle 过渡到 Idle**

![](https://pic4.zhimg.com/v2-24d46c2004011379c06b9b991b8fec37_r.jpg)

“停步过渡的总过程” 体现在从 Locomotion States 状态机里的 Stop 过渡到 Not Moving 的过程中。我们知道 NotMoving 里装着的是一个站立的 Pose，也就是 Idle。而 Stop 节点里总体上装着的是一个 “从 Cycle 过渡到 Idle 的**状态**”，也就是第一个 “**一边**”。

![](https://pica.zhimg.com/v2-59306f485eb63acda546b881c5a4f5be_r.jpg)

Pre-stop 里装着的就是 Cycle 动画。FootDown 导管指着的两个里装的也是，但是开启了 FootLock 的曲线，同样的，FootUp 导管指着的两个状态里更是直接装着与步伐对应的动画接触帧。这些都是老生常谈，没什么好说的。

在很多读者的认识里 LeftFoot 和 RightFoot 区分的是 “停步时左脚在前还是右脚在前”，“FootDown 和 FootUp 区分的是停步时在前面的这只脚处于下降还是上升状态”。以笔者的个人眼光来看，区分 LeftFoot 与 RightFoot，以及区分 FootDown 和 FootUp，本质上是在区分一次完整的迈步中的**相位**（迈一次左脚 + 迈一次右脚，加起来我们称为一个行走周期）。

我比较喜欢用 “相位” 来区分这些繁琐的 “左脚在前”、“左脚接触帧”、“右脚极限帧” 的称呼。只要规定 “左脚在前的接触帧（左脚往前迈并触地）” 的相位为 0，“右脚在前的接触帧（右脚往前迈并触地）”的相位为π，剩下的其他位置都好用相位来描述。

因为本质上这些区分都是在对相位做划分，所以我们可以看到，这些区分使用的都是动画序列中的 Feet_Position 曲线，将整个停步过程区分成了 4 个阶段。

![](https://pica.zhimg.com/v2-8e26e01886233a2c4e1cca080eff662e_r.jpg)

Feet_Position 曲线值绝对值变为 1 的瞬间，都是脚和地面完全接触的 “接触帧”，绝对值变为 0.2 的瞬间，则是一只脚上升到了最高点，要开始往下放了，称之为 “极限帧”。

### **1.2 整顿脚步**

在进入到 Stop 状态机的那 4 个状态节点中时，就会触发对应的蓝图事件。蓝图事件会以蒙太奇的形式播放整顿脚步的 Additive 动画。

![](https://pic1.zhimg.com/v2-d2c4e13913ab30db2d5eefc24882eb8a_r.jpg)

这对于一些读者来说可能是比较新鲜的。因为在我们通常的印象和认知中，蒙太奇常常会用于播放战斗中的一段技能，或者攻击的 Clip。而 Additive 动画也能作为蒙太奇播出，去给动画增加一个 “临时的” 叠加效果，却不怎么多见。

![](https://pic2.zhimg.com/v2-a2ca45606db5633c400296fad972ccf5_r.jpg)

被放在 Grounded Slot 播放的整顿脚步动画，自然地，会在 BaseLayer 的中段，MainGrouded States 的后面，从 Grounded Slot 节点中 “被唤起”，或者说是“涌现” 出来，并与它的输入做 Additive 叠加。

![](https://pic2.zhimg.com/v2-b14ce28b9f80239be38743213f5515f5_r.jpg)

### **1.3 按顺序锁定左右脚**

ALS 的脚部锁定可以简单划为 “锁定时机在哪判断”、“脚锁在哪个位置” 两个问题。其中锁定时机的问题基本是由记录在整顿脚步动画中的曲线来指明的。整顿脚步时脚抬起来自然就不锁，脚放到地上就锁。

在整顿脚步的动画中，我们可以看到 FootLock 曲线的身影。以 FootLock_L 曲线为例，FootLock_L 曲线的取值范围是 - 1~0。

![](https://pica.zhimg.com/v2-1c916491fd52420c688e410da624362a_r.jpg)

读者应该还有印象，在进入到 “左脚在前的停步” 的状态节点中时，都会把 FootLock_L 曲线设为 1。等于说，一共有两处修改 FootLock 曲线的地方，那以哪一边为准呢？

![](https://pic2.zhimg.com/v2-9e32ad698a11675fad97e1d424491fff_1440w.jpg)

事实上，Additive 动画中的曲线则会被以直接叠加的方式加到 BasePose 上。也就是说，虽然整顿脚步动画中它的值是 - 1~0，但由于在先锁定左脚的状态节点中我们将 FootLock_L 的曲线值设为了 1，所以实际上 FootLock_L 的曲线值的范围是 1+(-1) ~ 1+0，也就是 0~1 之间。

（ps：如果想知道为什么不打从一开始就直接让动画序列里的 footlock 曲线范围在 0~1 之间，而是特地做一个整体的加一减一的步骤，可以在笔者的新书出版后去书中寻找答案~）

FootLock 曲线值会直接影响到 FootLock 的透明度，ALS 为了避免滑步现象，只允许了锁脚的混出，禁止了混入。换言之它希望脚可以从 “不锁定的状态瞬间变成锁定的状态”。

![](https://picx.zhimg.com/v2-da66fd4f1d80d68786ad4e9e10961175_r.jpg)

此外，脚部锁定还要面临一个 “锁到哪” 的问题。这个问题可以通过让脚部骨骼在世界空间中的位置，扣去这一帧内骨骼网格体的移动量来反向得到上一帧的位置。换句话说，在停步的过程中角色移动组件会有一个减速的过程，在正常情况下脚容易发生滑动，但==我们在这个过程中让脚的位置不去跟着角色的网格体一起动（通过不断减去每一帧的网格体移动量来实现），就能实现脚部的锁定了。==

![](https://pica.zhimg.com/v2-8950f79944cfe537774e3e5a573d711c_r.jpg)

最后简单总结一下，ALS 的锁脚会从 Cycle 动画往 Idle 动画过渡（或是 FootUp 里先往接触帧过渡，再往 Idle 过渡），过渡时为了动画的表现效果，会在减速的过程中同时触发一个 Additive 的整顿脚步动画，通过 Slot 来直接动态叠加在动画输出上，最后为了避免减速时的滑步问题，还会利用整顿脚步动画里记录的 FootLock 曲线，来配合 FootIK 做脚部锁定。

## **3.Distance Match 主导的与[同步组](https://zhida.zhihu.com/search?content_id=233277964&content_type=Article&match_order=1&q=%E5%90%8C%E6%AD%A5%E7%BB%84&zhida_source=entity)主导的**

### **3.1Lyra 的距离匹配**

Lyra 中这种停步的思路更多地是放在 “怎么在停步时不滑步” 上，而不是 “怎么做好自然的停步” 上。这种方案其实更多适用于像 Lyra 动画包里那种很长的停步动画上，它会将冗余的动画前段给掐掉。对于一些可能一共就不到 10 帧就完成了从 Cycle 到 Idle 过渡的短停步动画而言，这个方案并不是很匹配。

Distance Match 在我们往期的文章中有详细讲解过，因此这里不会花额外的篇幅讲它的实现。[UE5 骨骼动画 Lyra 距离匹配 速度匹配 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/572811605)

![](https://pica.zhimg.com/v2-eaee65ed9fa7d58f19bebc0e060d3cf0_b.jpg)

![](https://picx.zhimg.com/v2-235500f97f80f486d07f102a7068a9dd_b.jpg)

需要指出的是，Distance Match 的构想听起来很美好，但它也有着一些难以克服的问题。因为它是基于 “停下来还需要多少距离” 来计算的停步动画的 “StartPosition” 的，也就是说它基本不会考虑停步动画在 StartPosition 处的相位和当前 Cycle 动画的相位的契合度有多少。

这就会导致在极端情况下发生如同第 0 节中一样的问题。比如我们上面录了 Lyra 的停步，在奔跑下只要在右脚在前时停步，就会看到左脚给快速拉到前面去的场景。Lyra 中的表现看着其实还可以，这是因为它在从 Cycle 混合到 Stop 时使用了 FastFeet 的混合配置，大幅度加快了脚的混合，让玩家感觉好像是角色多迈了一步，而不是脚被 “扯” 到前面去。这点值得我们借鉴。

![](https://pica.zhimg.com/v2-c602e3a446cc00a1e7fa0b80053cfade_r.jpg)

### 3.2 同步组与同步标记主导的

另外一种比较美好的构想是使用同步组与同步标记来实现。因为我们知道同步标记本身其实就相当于对两腿相位的一种划分——而且划分的十分精确，精确到 “L-R 小节，35%” 这样具体的比例。如果我们能让 Stop 停步动画作为跟随者，通过 Cycle 动画此刻所处的相位来决定自己起始播放的位置，岂不美哉？

想法是很美好的，可惜现实并不总是尽如人意。

[UE4 UE5 你真的会用同步标记吗？草履虫也能看懂的同步标记 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/614854028)

在我们往期讲解同步组的文章中提到了这个陷阱，Cycle 作为循环动画，将它作为领路者，Stop 作为跟随者的话，会导致 Stop 动画出现停滞、跳变、甚至跟着 Cycle 一起循环播放等异常现象。因此 Stop 动画只可能作为领路者。

但很快我们将看到 Stop 动画其实连领路者都当不了。

我们在 Lyra 中可以看到 Start 和 Cycle 同为一个同步组 Locomotion 的，而 Stop 却压根不跟它们放在同一个组里。这是为什么？

![](https://pic3.zhimg.com/v2-6cb8c63f37e76d1c04573295c415f66c_r.jpg)

![](https://pic3.zhimg.com/v2-e5c72c8207f677fb037e56ac2df37e38_r.jpg)

![](https://picx.zhimg.com/v2-57d72e304f62009b71e1ae1a2cece285_r.jpg)

因为这三者间的关系，是从 Start 单向过渡到 Cycle，Start 作为领路者，是 Cycle 去调整自己的 “StartPosition” 来配合当前角色动画播放到的位置。而当 Cycle 单向过渡到 Stop 时，按理来说是要 Stop 动画去调整自己的 “StartPosition” 来配合相位的，但倘若 Stop 作为领路者，从第一帧开始自然播放，本来的 Cycle 动画就得因此发生跳变了——自然，混合的结果也会出现跳变。

不过，对于程序来说，在停步发生时去拿到 Cycle 动画的同步标记（也就是相位信息），从而来决定 Stop 动画的开始位置，这一套流程自己手动来写并不是什么困难的事，所以我们完全可以借鉴同步组的思路，而不被 UE 的同步组所困住。

## **4. 局部的简易 Motion Matching**

在我们苦于繁琐的相位划分时，另一种方案带来了全新的可能性——利用 Motion Matching，或者说 [Pose Search](https://zhida.zhihu.com/search?content_id=233277964&content_type=Article&match_order=1&q=Pose+Search&zhida_source=entity)，通过对角色双脚的相位匹配，来直接从停步动画中搜索出一个合适的 “StartPosition”。

![](https://pic4.zhimg.com/v2-03bf35c0e8deedf7997912349737fcd7_b.jpg)

先看看效果，这个是我随手搓的简易版，还没有为停步起步添加防滑步措施，可以看到这里实现了 “停步、起步、Idle 都区分了左右”。

本节主要意在为读者们展现 MotionMatching 是怎样克服我们在第 1 节里提到的 “区分左右脚谁在前” 可能带来的动画蓝图逻辑复杂度按倍数增长的困境的。

很多读者可能觉得 MotionMatching 是特别高大上的东西，是 3A 游戏或者特别复杂的球类运动游戏才会用到的。其实是一种误解。

MotionMatching（以下简称 MM）本身虽然确实和动作捕捉、高度复杂的动画蓝图经常出现在一起，但 MM 的思路本质上和我们平时用的状态机没什么区别，都是 “**从众多动画资源中筛选出我们想播放的那个**”。

只不过用传统做法时我们可能要自己手动去计算一些相位啦、曲线啦七七八八的东西，来决定 “**筛选方式**”，而 MM 更多会依赖 Pose Match 和 Trajectory Match，也就是姿势和轨迹的匹配程度。从这个角度来看，MM 只不过是筛选动画的其中一种方式罢了，我们完全可以将它与其他方式结合起来使用。

我们本篇文章中一直在讨论的一个问题，其实就是 “从 Cycle 混入停步时，从哪一帧开始播放比较合适”，而这个问题用 Pose Match 来解决就非常合适。接下来，我将为各位读者展示一种有别于 3A 游戏 + 海量动捕动作库的，小而美的 MotionMatching。

（Tips：虽然这种 MM 会简易很多，但一些基础的东西还是要先稍微学习一下。我们这里不会展开聊的。读者可以参考笔者之前的文章 [UE5 Motion Matching 调参 血泪史 从入门到入土 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/642238437)，里面有推荐很多优秀的教程

![](https://picx.zhimg.com/v2-3212de6cc9e9feaaaca29b5e0806bd3b_r.jpg)

）

先看下文件结构，一个镜像表，一个 Schema，剩下的从 Idle 到 Stop 的 4 个状态共用这个 Schema。毕竟只是为了简单做个演示，实际项目中一般是要根据动画特点来为不同状态微调 Schema 的数值的。

![](https://pic4.zhimg.com/v2-ebbb082340638c2eb0921d19e4ce24c1_r.jpg)

![](https://picx.zhimg.com/v2-495ac8902f253ec4980c0955084d1b73_r.jpg)

用第 1.2 节的做法非常头疼的问题，如今一个镜像数据表就可以。

动画蓝图中 4 个状态都用分别使用一个 MM 节点，并配置对应的 DataBase。

![](https://pic1.zhimg.com/v2-9ab58fea0e511ed0a8830d6c2ba8a042_r.jpg)

![](https://pic2.zhimg.com/v2-6406de4a4f7f8ce02ce665bce540dd1d_r.jpg)

基本上主要内容就这些，是不是出乎意料的少？

可以看到，我们的 MotionMatching 没有把所有的动画都塞到一个 DataBase 里。每个 DataBase 里都只需要装一个动画就够了（如果不做 Strafe 的话）。**在一个 DataBase 里塞大量的动画其实是非常非常不提倡的行为**。我们解释下原因：

首先这会加大姿势搜索难度，我们可能只是想一直播一个 Cycle 动画，但却因为 Stop 动画的前半段和 Cycle 动作基本一致，而导致把 Stop 动画搜出来了（然后又因为 Search 间隔的设置，以及我们希望动画多继续往下播少搜索，导致角色在该 Cycle 的时候，把一个 Stop 动作做出来了……）。

其次会加大性能开销，因为可能这一帧我们明明只想要去搜一个停步动画出来，Idle 动画和 Start 动画却都混在数据库里参与搜索，使得这一帧白计算了很多不可能使用的帧。

不过，需要指出的是，虽然这种 MM 确实很好使，尤其是在做一些原型时拿来偷懒特别方便，但是目前 UE 对它的完成度确实还不算特别高。

比如 UE5 动画节点里的绑定函数，序列播放器和求值器都有很多可以用的，MM 节点同样作为动画采样节点家族的一员，却没啥能用的函数（像 Distance Match 如果想给 MM 节点用，就还得自己再改改）。

比如动画状态机里常用来在 Start->Cycle，Stop->Idle 中用来当过渡条件的 “当前动画序列剩余时间”（用来判断动画还剩多久播完），也不适用于 MM。

这些东西确实都不是啥很难的东西，要做起来很简单，应该是因为 MM 本身都还处在迭代阶段，这些细枝末节的东西如果现在就做了后面可能又得随着 MM 的改动而跟着重做，空耗人力。

最后，在有的读者心中，可能有着 MM 的性能开销大的刻板印象。

虽然我们放在动作库中供 MM 进行搜索的动画序列并不多，但每个序列几十帧，这积累下来也是一个难以无视的开销。那我们该怎么办？

我们还是依照着上面说的 “不要照搬 3A 游戏的做法，小而美就够了” 思路，既然动作库中可以只有寥寥几个动画序列，那能被 MM 搜索的动画帧能不能也只有寥寥几帧？

![](https://pic2.zhimg.com/v2-ea7e8b7850a578d5adcfdb39e6a8acf1_r.jpg)

比如，从 Cycle 过渡到 Stop 的时间其实一共就那么点，Stop 后面的大部分动作其实是完成过渡后自然播放的。换句话说 “Stop 动画的混入窗口期” 在整个序列中占的比重是很小的。顺着这个思路，我们就可以使用 BlockTransitions 的动画通知状态，使得 Stop 动画中大部分帧是只能被自然步进播放到，而不能被 MM 搜索出来作为 “开始帧” 的。

同理，其他动画序列也可以用这样的思路来优化。

## 后记（闲聊）

大家好，我是 DarkFlameMaster。时隔 3 个月又更新了一篇文章了。这下更新速度堪比日本新番按季出了…… 秋季新文，冬季新文，一年四更…… 开玩笑的，今年上半年确实因为上班而很忙，但我更新频率下降这么多的主要原因还是——

“**我想要分享的是不是大伙都已经知道的，或者是没太多营养的内容？会不会感觉像是在水文章？**”

这样的想法已经让我有两三篇写到一半的文章胎死腹中了。因为随着我的水平不断提高，我总感觉我有义务去分享一些 “网上没有的，不曾有人写过的，比较困难的” 东西，而不是去写一些有所重复的内容。我觉得写一篇 “比较水” 的文章出来是在浪费读者的时间。

![](https://pic4.zhimg.com/v2-0ed63d9350d128664b21bad97ff80d99_r.jpg)

其中一篇胎死腹中的

这样做的好处是，今年我写的 3 篇文章，确实我有这个信心说无论哪一篇都是网上很难得一见的，质量和内容都能无愧于读者的。坏处是，今年也就只写了 3 篇文章……

但，现在我想通了，我最开始踏上这条路时，去笨拙地模仿前人的脚步都磕磕绊绊，不成模样（详见我最早写的那篇垃圾回收），在刚开始学动画的时候，写出来的文章也同样是在重复、提炼别人教过的内容。

但这又如何？我最开始写文章的初心是教学相长，是为了帮助我自己更好地理解知识，掌握知识，其次才是在这个过程中，尽量地把文章写好，让读我文章的人也能有所收获。哪怕现在在我的眼光看来写出来会 “很水” 的文章，也至少是能帮助到一些刚入门的初学者的，而只要有人能获得一点帮助，我的文章就不算白写。

因此，后续的更新频率应该会提升（大概），近期那篇写到一半的八向移动方案应该就会发布了。

还有就是，大家也知道我其实还是个大学生，明年毕业。这一两个月秋招参加下来，老实说，没想到会这么难。

![](https://pica.zhimg.com/v2-54e956f4d1c05f3ea0e59cef2009a606_1440w.jpg)

对我来说应该改成 “woc，新邮件，是不是和我约面试了”……

我本以为我知乎上只靠技术文章就能有 1w 关注，在骨骼动画这块也有一定影响力，再怎么说，相较其他应届生来说，还是比较有竞争力的。结果到现在我投递的，加上皮皮哥等热心网友帮我内推的，已经有 30 家了，却一个正式 offer 都没有……（腾讯更是，3 位热心网友 1 位学长帮我内推，到现在还是面都不面我……）

![](https://picx.zhimg.com/v2-9db4388a0033cb4de5e6f76b46a5b9b5_1440w.jpg)

诚然，因为信息的不足，我对秋招没能做到最好的准备，方向的选择也是后面才逐渐清晰，为此浪费了好些宝贵的机会。我的算法水平也不够硬，做笔试时 4 道编程总是只能做出前几道容易的，一到后面的复杂题，模拟题就吃瘪（导致到现在一家笔试没过）。是的，我知道的，我自己其实也有很多问题。

![](https://pic3.zhimg.com/v2-a87627093865e95290521e055428f930_b.jpg)

让读者朋友们见笑了。

但，就像我在文章首和文章末，摘录的《恋爱随意链接》里的语录说的那样——

我知道我走了很多，很多的弯路，我许多地方都没能做到尽善尽美。但那都已经是那时的我在有限的条件下能做到的最好了，我不是全知全能的，我也喜欢摸鱼偷懒，我只是一个普通人。虽然走了很多弯路，吃了很多挫折，但正是那些，构成了如今的我，而我不想否定我自己。

今年的秋招形势，很难，和我同届的同学中 10 个人里只有一个拿到了正式 offer。环境的确很差。但抱怨环境很差并不能改变什么东西。叹一口气，然后接受这一切。无论身处怎样的黑暗，都不会放弃寻找光明——这才称得上战斗，不是吗？

最后，祝大家身体健康。经济的上升与下降都只是以几年，十几年为一个循环周期，而人生几十年时光，这样的日子要经历的可能不止一次，是否找的到工作都只是一时的，而健康却是一辈子的。

**骨骼动画交流群**：916274600，有遇到不开心的欢迎来聊聊。

人们经常只会怨叹自己的遭遇。 抱怨「都是因为变成那样害的」，怨恨着变成那样一事，还有幻想着「假如不是那样」根本不存在的虚构世界。因为只要推卸过错，然后说「因为怎么样所以不可能」，就能被原谅了。 但那只不过是名为「放弃」的逃亡，虽然像是面对现实、用常理思考，但其实根本没有任何帮助。  
无论身处怎样的状态，都会从中找出光明——这才称得上是战斗，不是吗？

![](https://pic2.zhimg.com/v2-506b11e2477b9176839355f6a5aeef39_r.jpg)

![](https://pic3.zhimg.com/v2-338cd3efb761210b23fe06ac638e63fc_r.jpg)

經典詠流傳！

![](https://pic4.zhimg.com/v2-b6bb8549f7b8f29a11e7f326a6e22a61_r.jpg)