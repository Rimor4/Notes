# 大世界技术

## 空间划分

### BVH

BVH实际是按”物体“划分而不是空间划分。

结构特点

- 每个节点：
  - 一个 **包围盒（AABB / OBB / Sphere）**
  - 若干子节点
- **叶子节点存的是物体**
- 非叶子节点的包围盒 = 子节点包围盒的并集



### KD-Tree

### 分层网格

松散四叉树（Loose Quadtree）与网格法（Grid/Chunk）结合。

**网格法（Grid）的局限**：网格是平面的。如果物体跨越了四个格子的交点，网格法很难处理。此外，对于大小不一的物体（如小草和巨大的山脉），固定大小的网格要么太浪费（格太小），要么不精确（格太大）。

**松散四叉树（Loose Quadtree）的局限**：树结构在内存上是散乱的指针，对 CPU 缓存（Cache）不友好。频繁的插入和删除（动态物体移动）会导致大量的树重构开销。



**结合方案**：网格作为容器，四叉树作为索引

这种架构通常采取**“大世界切块（Chunk）+ 块内四叉树”**或**“四叉树叶子节点存放网格”**的方式。

#### A. 空间划分层级

1. **第一层：静态大网格 (World Grid/Chunks)**
   - 将世界划分为 $512m \times 512m$ 的静态 Chunk。这些 Chunk 负责资源加载（Stream Loading）。
2. **第二层：松散四叉树索引 (Inside Chunk)**
   - 在每个 Chunk 内部维护一棵松散四叉树。
   - **松散特性**：每个节点的包围盒（Boundary）比物理尺寸大 1.5 到 2 倍。

#### B. 核心机制：松散性的应用

- **解决跨边界问题**：由于四叉树节点是“松散”的（有重叠区域），原本处于四个格子交界处的物体，可以被收纳在某一个具有足够大空间的子节点中，而不需要非得提升到根节点。
- **减少抖动**：物体在移动时，只要不超出那个“扩大了的”逻辑边界，就不需要更新它在树中的节点位置。



### UE World Partition

